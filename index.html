<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç°¡å ±ç®±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { background-color: #f9f7f3; font-family: "Segoe UI", sans-serif; color: #333; padding: 2em; }
    h1 { font-size: 1.8em; margin-bottom: 0.5em; }
    .section { border-left: 6px solid #3c79ff; background: #fff; padding: 1em; margin-bottom: 2em; border-radius: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .section h2 { font-size: 1.3em; margin-top: 0; display: flex; align-items: center; gap: 0.3em; }
    .tool-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .btn { display: inline-block; padding: 0.8em 1.6em; background-color: #3c79ff; color: white; border-radius: 8px; text-decoration: none; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; }
    .windy-section iframe { width: 100%; height: 600px; border: none; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); margin-bottom: 1em; }

/* â¬‡ï¸ å¤©æ°£2æ ¼åœ–çš„æ’åˆ—é–‹å§‹ */
.img-grid-2col {
  display: flex;
  flex-wrap: wrap;
  gap: 1em;
  justify-content: center;
}

.img-grid-2col img {
  width: calc(100% / 2 - 1em);  /* å…©æ¬„ */
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  max-width: 100%;
  height: auto;
}

@media (max-width: 768px) {
  .img-grid-2col img {
    width: 100%;  /* æ‰‹æ©Ÿç‰ˆå–®æ¬„ */
  }
}
/* å¤©æ°£2æ ¼åœ–çš„çµæŸ */

 // é¡¯è‘—å¤©æ°£é–‹å§‹       
    .img-column {
  text-align: center;
}

.img-column img {
  display: block;
  max-width: 800px;
  height: auto;
  margin: 0 auto 10px auto;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

 // é¡¯è‘—å¤©æ°£çµæŸ
    
    .button-row { margin-bottom: 8px; }  
     button { margin-top: 5px; padding: 0.8em 1.6em; font-size: 1.1em; background: #3c79ff; color: #fff; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    #map, textarea {
     width: 100%;
     max-width: 800px;
     margin-top: 10px;
     border-radius: 8px;
     box-shadow: 0 2px 6px rgba(0,0,0,0.1);
     }
     #map {height: 600px;}
      textarea {height: 100px;}
 
    .section{ overflow-x: auto;}
    .leaflet-popup-content {width: auto; min-width: 220px; max-width: 90%;}
    .leaflet-popup-content pre { white-space: pre-wrap; word-break: break-word; width: 100%; max-height: 60vh; overflow-y: auto; -webkit-overflow-scrolling: touch; margin: 0; padding: 0.2em; font-size: 0.9em;}

    body { background: #f9f7f3; font-family: "Segoe UI", sans-serif; color: #333; padding: 2em; }
  .flight-box { border-left: 6px solid #3c79ff; background: #fff; padding: 1em; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);}
  select { font-size: 1em; padding: 0.5em; margin-left: 0.5em;}

    .windy-section h2 button {
  background: none;
  border: 2px solid #3c79ff;
  border-radius: 6px;
  padding: 4px 10px;
  margin-left: 12px;
  font-size: 0.9em;
  color: #3c79ff;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.2s, color 0.2s;
}
.windy-section h2 button:hover {
  background-color: rgba(60,121,255,0.1);
  color: #2c5edc;
}
    .checklist {
  list-style: none;
  padding: 0;
  margin: 0 0 1em 0;
}
.checklist li {
  padding: 0.5em 0;
  border-bottom: 1px dashed #ccc;
}
.checklist label {
  font-size: 1em;
  display: flex;
  align-items: center;
  gap: 10px;
}
.checklist input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: #3c79ff;
}

/* â›½ Fuel Calculator å€å¡Š */
.fuel-box h2 {
  font-size: 1.3rem;
  margin-top: 0;
  display: flex;
  align-items: center;
  gap: 0.3em;
}

.fuel-box h3 {
  font-size: 1.1rem;
  margin-top: 1.2rem;
  margin-bottom: 0.3rem;
}

.fuel-box .hint {
  font-size: 0.9rem;
  color: #555;
  margin-bottom: 0.8rem;
}

.fuel-box .input-row {
  margin: 0.5rem 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.fuel-box .input-row label {
  min-width: 8rem;
}

.fuel-box .input-row input[type="number"] {
  width: 8rem;
  padding: 0.3rem 0.4rem;
}

.fuel-box .input-row button {
  padding: 0.35rem 0.9rem;
  cursor: pointer;
  font-size: 0.95rem;
}

.fuel-box #message {
  margin-top: 0.5rem;
  font-size: 0.9rem;
  color: #b00;
}

.fuel-box .note {
  font-size: 0.85rem;
  color: #666;
  margin-top: 0.3rem;
}

/* åªåœ¨æ²¹é‡å€å¡Šå…§å¥—ç”¨è¡¨æ ¼æ¨£å¼ï¼Œé¿å…å½±éŸ¿å…¶ä»–å€å¡Š */
.fuel-box table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.5rem;
}

.fuel-box th,
.fuel-box td {
  border: 1px solid #ccc;
  padding: 0.4rem 0.5rem;
  text-align: right;
  font-size: 0.95rem;
}

.fuel-box th:first-child,
.fuel-box td:first-child {
  text-align: left;
}

.fuel-box th {
  background: #f5f5f5;
}
    
    
</style>
</head>
<body>
  
  <h1>ğŸ“¦ ç°¡å ±ç®±ï¼ˆBriefing Packageï¼‰</h1>

  <div class="section">
    <h2>ğŸ—ºï¸ å¿«é€Ÿå·¥å…·é€£çµ</h2>
    <div class="tool-grid">
      <a class="btn" href="https://flight-plan-editor.weathernews.com/flight_plan_editor/#login" target="_blank">â˜ï¸Weathernews Flight Plan Editor</a>
      <a class="btn" href="https://pilotstarspace.starlux-airlines.com/#/" target="_blank">ğŸŒŸSJX Pilot Space</a>
      <a class="btn" href="https://elb.starlux-airlines.com/elb/#/dashboard/fleet" target="_blank">ğŸ§°STARLUX ELB Fleet</a> 
      <a class="btn" href="https://tono2.net" target="_blank">ğŸ‡¯ğŸ‡µTono2 èˆªç©ºæ°£è±¡</a>
      <a class="btn" href="https://sjx.lido.aero/lido/las/login.jsp?DESMON_RESULT_PAGE=https://sjx.lido.aero/briefing&DESMON_CODE=LAS_001&DESMON_LANG=null" target="_blank">ğŸ“‹LIDO Briefing</a>
      <a class="btn" href="https://www.skyinfo.jp" target="_blank">ğŸ‡¯ğŸ‡µæ—¥æœ¬NOTAMåœ°åœ–</a>
      <a class="btn" href="https://app.cwa.gov.tw/web/obsmap/typhoon.html" target="_blank">ğŸŒ€é¢±é¢¨è·¯å¾‘åœ–</a>
      <a class="btn" href="https://zihchi.github.io/flight-time/" target="_blank">ğŸ’»é£›æ™‚è¨ˆç®—å·¥å…·</a>
      <a class="btn" href="https://gpsjam.org/" target="_blank">ğŸ›°ï¸GPSå¹²æ“¾å€åŸŸ</a>
    </div>
  </div>
<div class="section">

  <h3>ğŸ§³ å€‹äººè£å‚™æª¢æŸ¥è¡¨</h3>
  <ul class="checklist" id="personalChecklist">
    <li><label><input type="checkbox"> Sign On</label></li>
    <li><label><input type="checkbox"> æ›´æ–°ï¼šFlysmart / Aviobook / FD PRO</label></li>
    <li><label><input type="checkbox"> Passport / ID / Flashlight / MED / CAA / Ğ Ğ¢Ğ Ğ¡</label></li>
    <li><label><input type="checkbox"> å…¥å¢ƒç™»è¨˜</label></li>
    <li><label><input type="checkbox"> Fleet Notice</label></li>
  </ul>

  <h3>ğŸ“‹ ç°¡å ±æª¢æŸ¥æ¸…å–®ï¼ˆPIREPSï¼‰</h3>
  <ul class="checklist" id="briefingChecklist1">
    <li><label><input type="checkbox"> Personal equipments</label></li>
    <li><label><input type="checkbox"> Information : ç­è™Ÿã€æ™‚é–“ã€é£›æ™‚ã€å·¡èˆªé«˜åº¦</label></li>
    <li><label><input type="checkbox"> Registration : æ©Ÿè™Ÿã€æ—…å®¢ã€æ²¹é‡ã€é‡é‡ã€æ°´é‡ã€åœæ©Ÿä½</label></li>
    <li><label><input type="checkbox"> Enroute Wx : å‡ºç™¼åœ°ã€ç›®çš„åœ°ã€èˆªè·¯ã€å‚™é™</label></li>
    <li><label><input type="checkbox"> Performance : MEL</label></li>
    <li><label><input type="checkbox"> Special Procedure : CAAWTF</label></li>
  </ul>

</div>

<div class="section">
  <h2>ğŸ“¢ å…¬å‘Šæ¬„ </h2>
  <iframe
    src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQ4iKWN7xdzmDkyChPvTfBCp7C2sJqznWaZR9l_1TnPFl4b2RqV3N1t8Y08dh1ssngXo7RbDOARxSsI/pubhtml?widget=true&headers=false"
    style="width:100%; height:480px; border:none; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.08);"
  ></iframe>
</div>

  
<div class="section">
  <h2>ğŸ›« Turbli èˆªç­äº‚æµæŸ¥è©¢</h2>
  <label for="flightSelect">è«‹é¸æ“‡èˆªç­ï¼š</label>
  <select id="flightSelect" style="margin-right:1em;"></select>
  <label for="dateSelect">è«‹é¸æ“‡æ—¥æœŸï¼š</label>
  <select id="dateSelect" style="margin-right:1em;">
    <option value="today">ä»Šå¤©</option>
    <option value="tomorrow">æ˜å¤©</option>
  </select>
  <button id="turbliBtn" onclick="openTurbli()" disabled>æŸ¥è©¢</button>
  <a href="https://turbli.com/" target="_blank" style="margin-left: 1em;">
    <button type="button">å®˜ç¶²</button>
  </a>
</div>

  <div class="section">
  <h2>ğŸŒ D-ATIS</h2>
  <label for="datisSelect">è«‹é¸æ“‡æ©Ÿå ´ï¼š</label>
  <select id="datisSelect" onchange="openDatis()" style="margin-right: 1em;">
    <option selected disabled>--è«‹é¸æ“‡æ©Ÿå ´--</option>
    <optgroup label="å°ç£ã€é¦™æ¸¯">
      <option value="https://atis.guru/">ATIS å®˜æ–¹ç¶²ç«™</option>
      <option value="https://atis.guru/atis/RCTP">RCTP æ¡ƒåœ’</option>
      <option value="https://atis.guru/atis/RCSS">RCSS æ¾å±±</option>
      <option value="https://atis.guru/atis/RCKH">RCKH é«˜é›„</option>
      <option value="https://atis.cad.gov.hk/ATIS/ATISweb/atis.php">VHHH é¦™æ¸¯</option>
    </optgroup>
    <optgroup label="æ—¥æœ¬">
      <option value="https://atis.guru/atis/ROAH">ROAH æ²–ç¹©</option>
      <option value="https://atis.guru/atis/RJFF">RJFF ç¦å²¡</option>
      <option value="https://atis.guru/atis/RJFT">RJFT ç†Šæœ¬</option>
      <option value="https://atis.guru/atis/RJBB">RJBB é—œè¥¿</option>
      <option value="https://atis.guru/atis/RJGG">RJGG ä¸­éƒ¨</option>
      <option value="https://atis.guru/atis/RJTT">RJTT ç¾½ç”°</option>
      <option value="https://atis.guru/atis/RJAA">RJAA æˆç”°</option>
      <option value="https://atis.guru/atis/RJSS">RJSS ä»™å°</option>
      <option value="https://atis.guru/atis/RJCH">RJCH å‡½é¤¨</option>
      <option value="https://atis.guru/atis/RJCC">RJCC æ–°åƒæ­²</option>
    </optgroup>
    <optgroup label="æ±å—äº">
      <option value="https://atis.guru/atis/VTBS">VTBS æ›¼è°·</option>
      <option value="https://atis.guru/atis/WSSS">WSSS æ–°åŠ å¡</option>
      <option value="https://atis.guru/atis/WMKK">WMKK å‰éš†å¡</option>
    </optgroup>
    <optgroup label="è¶Šå—">
      <option value="https://atis.guru/atis/VVTS">VVTS èƒ¡å¿—æ˜</option>
      <option value="https://atis.guru/atis/VVNB">VVNB æ²³å…§</option>
      <option value="https://atis.guru/atis/VVDN">VVDN å³´æ¸¯</option>
    </optgroup>
  </select>
</div>

 <div class="section">
  <h2>ğŸŒ¦ï¸ åŸå¸‚å¤©æ°£</h2>
  <label for="citywxSelect">è«‹é¸æ“‡åŸå¸‚ï¼š</label>
  <select id="citywxSelect" onchange="openCitywx()" style="margin-right: 1em;">
    <option selected disabled>--è«‹é¸æ“‡åŸå¸‚--</option>
    <optgroup label="å°ç£ã€é¦™æ¸¯">
      <option value="https://www.bbc.com/weather/6696918">RCTP æ¡ƒåœ’</option>
      <option value="https://www.bbc.com/weather/1673820">RCKH é«˜é›„</option>
      <option value="https://www.bbc.com/weather/1819729">VHHH é¦™æ¸¯</option>
    </optgroup>
       <optgroup label="æ—¥æœ¬">
      <option value="https://www.bbc.com/weather/1894616">ROAH æ²–ç¹©</option>
      <option value="https://www.bbc.com/weather/1863967">RJFF ç¦å²¡</option>
      <option value="https://www.bbc.com/weather/1858421">RJFT ç†Šæœ¬</option>
      <option value="https://www.bbc.com/weather/1853909">RJBB å¤§é˜ª</option>
      <option value="https://www.bbc.com/weather/1856057">RJGG åå¤å±‹</option>
      <option value="https://www.bbc.com/weather/1850147">RJTT æ±äº¬</option>
      <option value="https://www.bbc.com/weather/2111684">RJAA æˆç”°</option>
      <option value="https://www.bbc.com/weather/6300399">RJSS ä»™å°</option>
      <option value="https://www.bbc.com/weather/2130188">RJCH å‡½é¤¨</option>
      <option value="https://www.bbc.com/weather/2128295">RJCC æœ­å¹Œ</option>
    </optgroup>
    <optgroup label="æ±å—äº">
      <option value="https://www.bbc.com/weather/1609350">VTBS æ›¼è°·</option>
      <option value="https://www.bbc.com/weather/1880252">WSSS æ–°åŠ å¡</option>
      <option value="https://www.bbc.com/weather/1735161">WMKK å‰éš†å¡</option>
    </optgroup>
    <optgroup label="è¶Šå—">
      <option value="https://www.bbc.com/weather/1566083">VVTS èƒ¡å¿—æ˜</option>
      <option value="https://www.bbc.com/weather/1581130">VVNB æ²³å…§</option>
      <option value="https://www.bbc.com/weather/1583992">VVDN å³´æ¸¯</option>
    </optgroup>
  </select>
</div>

  <div class="section windy-section">
  <h2>ğŸŒ§ï¸ Windy å³æ™‚é›·é”åœ– 
    <button onclick="refreshIframe('windyRadar')">é‡æ–°æ•´ç†</button>
  </h2>
  <iframe id="windyRadar" src="https://embed.windy.com/embed2.html?lat=23.5&lon=120.9&zoom=7&level=surface&overlay=radar"
    style="width:100%;height:600px;border:none;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);"></iframe>
</div>

<div class="section windy-section">
  <h2>ğŸŒ¤ï¸ Windy è¡›æ˜Ÿé›²åœ–
    <button onclick="refreshIframe('windySatellite')">é‡æ–°æ•´ç†</button>
  </h2>
  <iframe id="windySatellite"
    src="https://embed.windy.com/embed2.html?lat=23.5&lon=120.9&zoom=4&level=surface&overlay=satellite&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&detailLat=23.5&detailLon=120.9&metricWind=kt&metricTemp=C&radarRange=-1"
    style="width:100%;height:600px;border:none;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);"></iframe>
</div>


<div class="section windy-section">
  <h2>ğŸŒ¬ï¸ Windy é¢¨é€Ÿåœ– (Surface Wind) 
    <button onclick="refreshIframe('windyWindSurface')">é‡æ–°æ•´ç†</button>
  </h2>
  <iframe id="windyWindSurface" 
    src="https://embed.windy.com/embed2.html?lat=23.5&lon=120.9&zoom=4&level=surface&overlay=wind"
    style="width:100%;height:600px;border:none;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);">
  </iframe>
</div>


<div class="section windy-section">
  <h2>âœˆï¸ Windy æ™´ç©ºäº‚æµåœ– (FL340) 
    <button onclick="refreshIframe('windyTurbFL340')">é‡æ–°æ•´ç†</button>
  </h2>
  <iframe id="windyTurbFL340" src="https://embed.windy.com/embed2.html?lat=23.5&lon=120.9&zoom=4&level=250h&overlay=turbulence"
    style="width:100%;height:600px;border:none;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);"></iframe>
</div>

  
<div class="section windy-section">
  <h2>âœˆï¸ Windy æ™´ç©ºäº‚æµåœ– (FL390) 
    <button onclick="refreshIframe('windyTurbFL390')">é‡æ–°æ•´ç†</button>
  </h2>
  <iframe id="windyTurbFL390" src="https://embed.windy.com/embed2.html?lat=23.5&lon=120.9&zoom=4&level=200h&overlay=turbulence"
    style="width:100%;height:600px;border:none;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.1);"></iframe>
</div>

<div class="section windy-section"> <h2>ğŸŒ«ï¸ WAQI å…¨å°ç©ºæ°£å“è³ªåœ°åœ–</h2> 
  <iframe width="100%" height="600" src="https://waqi.info/#/c/23.7/121.0/7z" frameborder="0" style="border:none;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);"></iframe> 
</div>
  
  <div class="section">
  <h2>ğŸŒ å¤©æ°£åœ–æ¦‚æ³åœ–</h2>
  <div class="img-grid-2col">
    <img src="https://www.cwa.gov.tw/Data/radar/CV1_TW_1000_forPreview.png" alt="é›·é”åœ–">
    <img src="https://www.cwa.gov.tw/Data/rainfall/QZJ_forPreview.jpg" alt="é›¨é‡">
    <img src="https://www.cwa.gov.tw/Data/UVI/UVI_forPreview.png" alt="ç´«å¤–ç·š">
    <img src="https://www.cwa.gov.tw/Data/temperature/temp_forPreview.jpg" alt="æº«åº¦">
     <img src="https://tenki.lbw.jp/imagedata/tubo/LBWwb_tubo_1.jpg" alt="å¤©æ°—ã®ãƒ„ãƒœ ã‚ã•">
    <img src="https://tenki.lbw.jp/imagedata/tubo/LBWwb_tubo_2.jpg" alt="å¤©æ°—ã®ãƒ„ãƒœ ã‚ˆã‚‹">
  </div>
</div>
<div class="section">
    <h2>ğŸŒé¡¯è‘—å¤©æ°£åœ–</h2>
    <div class="img-column">
      <img src="https://www.data.jma.go.jp/airinfo/data/pict/ajpn_cmnt/qyya86-0.png">
      <img src="https://www.data.jma.go.jp/airinfo/data/pict/fbjp/fbjp.png">
      <img src="https://www.data.jma.go.jp/airinfo/data/pict/ajpn_cmnt/qyya82.png">
    </div>
  </div>

  <div class="section fuel-box">
    <h2>â›½ Fuel Distribution & Refuel Time Calculator</h2>

    <div class="hint">
      å–®ä½ï¼šå™¸ï¼ˆtï¼‰ã€‚è³‡æ–™æœ‰æ•ˆç¯„åœï¼š8.8 t ï½ 100 tã€‚<br>
      ç›®å‰å‡è¨­ï¼š<br>
      1ï¼‰å‰©æ²¹åˆ†å¸ƒç‚º Inner = ç›®å‰ç¸½æ²¹é‡ï¼Œå…¶é¤˜æ²¹ç®± = 0ã€‚<br>
      2ï¼‰åŠ æ²¹æ™‚ Trim Tank ä»¥å›ºå®š 0.1 t/min åŠ æ²¹ã€‚<br>
      3ï¼‰Inner / Outer / Center ä¸‰å€‹æ²¹ç®±å…±ç”¨ 1.0 t/minï¼ŒåŠ æ²¹æ™‚å‡åˆ†æµé‡ï¼š<br>
         - ä¸‰å€‹éƒ½åœ¨åŠ æ²¹ï¼šå„ 1/3 t/minï¼›<br>
         - è‹¥å…¶ä¸­ä¸€å€‹å…ˆæ»¿ï¼Œå‰©ä¸‹å…©å€‹å„ 1/2 t/minï¼›<br>
         - æœ€å¾Œåªå‰©ä¸€å€‹æ™‚å‰‡ç‚º 1 t/minã€‚
    </div>

    <div class="input-row">
      <label for="currentFuel">ç›®å‰å‰©æ²¹ (Total)ï¼š</label>
      <input
        type="number"
        id="currentFuel"
        step="0.1"
        placeholder="ä¾‹å¦‚ï¼š20.0"
      />
    </div>
    <div class="input-row">
      <label for="targetFuel">ç›®æ¨™ Total Fuelï¼š</label>
      <input
        type="number"
        id="targetFuel"
        step="0.1"
        placeholder="ä¾‹å¦‚ï¼š60.0"
      />
      <button type="button" onclick="onCalculate()">è¨ˆç®—</button>
    </div>

    <div id="message"></div>

    <h3>ä¸€ã€ç›®æ¨™æ²¹é‡æ™‚çš„æ²¹é‡åˆ†å¸ƒ</h3>
    <table>
      <thead>
      <tr>
        <th>é …ç›®</th>
        <th>æ²¹é‡ (t)</th>
      </tr>
      </thead>
      <tbody id="resultBody">
      <tr><td>Inner Tank</td><td>-</td></tr>
      <tr><td>Outer Tank</td><td>-</td></tr>
      <tr><td>Trim Tank</td><td>-</td></tr>
      <tr><td>Center Tank</td><td>-</td></tr>
      <tr><th>Total (Inner+Outer+Trim+Center)</th><th>-</th></tr>
      </tbody>
    </table>

    <h3>äºŒã€åŠ æ²¹é‡èˆ‡åŠ æ²¹æ™‚é–“</h3>
    <table>
      <thead>
        <tr>
          <th>æ²¹ç®±</th>
          <th>åŠ æ²¹é‡ Î” (t)</th>
          <th>åŠ æ²¹æµé‡ (t/min)</th>
          <th>æ‰€éœ€æ™‚é–“ (min)</th>
        </tr>
      </thead>
      <tbody id="timeBody">
        <tr><td>Inner Tank</td><td>-</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>-</td></tr>
        <tr><td>Outer Tank</td><td>-</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>-</td></tr>
        <tr><td>Trim Tank</td><td>-</td><td>0.10</td><td>-</td></tr>
        <tr><td>Center Tank</td><td>-</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>-</td></tr>
        <tr><th>ç¸½åŠ æ²¹é‡ (t)</th><th>-</th><th>ç­‰æ•ˆæµé‡ (t/min)</th><th>-</th></tr>
        <tr><th>ç¸½åŠ æ²¹æ™‚é–“</th><th colspan="3">-</th></tr>
      </tbody>
    </table>
    <div class="note">
      Inner / Outer / Center ä»¥ã€Œå…±äº« 1.0 t/minã€æ–¹å¼åŠ æ²¹ï¼Œæœ¬è¡¨å·²è€ƒæ…®ï¼šæ²¹ç®±å…ˆæ»¿è€…å…ˆåœæ­¢ï¼Œå‰©é¤˜æ²¹ç®±è‡ªå‹•åˆ†é…è¼ƒé«˜æµé‡ã€‚<br>
      ç¸½åŠ æ²¹æ™‚é–“ç‚º IOC ä¸‰ç®±å®Œæˆæ™‚é–“èˆ‡ Trim Tank å®Œæˆæ™‚é–“å…©è€…ä¸­çš„è¼ƒå¤§å€¼ï¼ˆåŒæ™‚é€²è¡Œï¼‰ã€‚<br>
      è‹¥æŸæ²¹ç®±ç›®æ¨™æ²¹é‡ä½æ–¼èµ·å§‹æ²¹é‡ï¼Œå°‡ä¸è¨ˆå…¥åŠ æ²¹é‡ï¼ˆè¦–ç‚ºåƒ…æ²¹ç®±å…§éƒ¨å†åˆ†é…ï¼‰ã€‚
    </div>
  </div>



  
  <div class="section">
    <h2>ğŸ“ NOTAM åº§æ¨™åœ°åœ–</h2>
    <div class="button-row">
      <button onclick="addNotam()">ç”¢å‡ºåœ°åœ–</button>
      <button onclick="clearMap()">æ¸…é™¤å…¨éƒ¨</button>
    </div>
    <textarea id="notamInput" placeholder="ç›´æ¥è²¼æ•´æ®µ NOTAM"></textarea>
    <div id="map"></div>
  </div>

  
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
let map = L.map('map').setView([23.5, 121], 7);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let shapeLayers = [];

// â¬‡ï¸ æŠŠ N320229E1240000 è½‰æˆ N320229 E1240000
function normalizeDMS(c){
  c = c.toUpperCase();
  let m = c.match(/([NS])(\d+)/);
  if (m) return m[2] + m[1];
  m = c.match(/([EW])(\d+)/);
  if (m) return m[2] + m[1];
  return c;
}

// â¬‡ï¸ å°‡ 320229N 1240000E è½‰åé€²ä½ï¼ˆddmmss / dddmmssï¼‰
function dmsToDecimal(d){ 
  let m = d.match(/(\d{2,3})(\d{2})(\d{2}(?:\.\d+)?)([NSEW])/);
  if (!m) return NaN;
  let dec = +m[1] + (+m[2]/60) + (+m[3]/3600);
  return (m[4] === 'S' || m[4] === 'W') ? -dec : dec;
}

function parseNotamBlock(block){
  const popupOptions = {
    maxWidth: map.getSize().x * 0.5,
    keepInView: true,
    autoPan: true
  };

  // â¬‡ï¸ å…ˆè™•ç†ç¬¦è™Ÿäº‚ç¢¼ã€æ›è¡Œã€æ¨™é»ã€ä»¥åŠç”¨ - ä½œç‚ºåˆ†éš”
  block = block.replace(/[â€™']/g,"'").replace(/[â€"]/g,'"'); 
  block = block.replace(/-/g," ");   // SIGMET / NOTAM å¸¸è¦‹ç”¨ - åˆ†éš”é»ï¼Œçµ±ä¸€è½‰ç©ºç™½
  block = block
    .replace(/[\n\r]+/g," ")
    .replace(/[,:;()\u3000]+/g," ")
    .replace(/\s+/g," ")
    .trim();

  let coords = [];

  // â¬‡ï¸ å°ˆé–€è§£æ N32Â°02â€™29â€E124Â°00â€™00â€ é€™ç¨®æ ¼å¼
  for (let match of block.matchAll(/([NS])(\d{2})[Â°]?(\d{2})['â€™](\d{2})["â€]?([EW])(\d{3})[Â°]?(\d{2})['â€™](\d{2})["â€]?/g)){
    let lat = (+match[2]) + (+match[3])/60 + (+match[4])/3600;
    if (match[1] === 'S') lat = -lat;
    let lon = (+match[6]) + (+match[7])/60 + (+match[8])/3600;
    if (match[5] === 'W') lon = -lon;
    coords.push([lat, lon]);
  }

  // â¬‡ï¸ SIGMET å¸¸è¦‹æ ¼å¼ï¼šN1124 E11715 é€™ç¨®ã€Œddmm / dddmmã€ç„¡ç§’æ–¹å¼
  // ä¾‹å¦‚ï¼šN1124 E11715 - N1013 E11651 - N0914 E11529 - ...
  for (let m of block.matchAll(/([NS])(\d{2})(\d{2})\s*([EW])(\d{3})(\d{2})/g)){
    let lat = (+m[2]) + (+m[3])/60;       // dd + mm/60
    if (m[1] === 'S') lat = -lat;

    let lon = (+m[5]) + (+m[6])/60;       // ddd + mm/60
    if (m[4] === 'W') lon = -lon;

    coords.push([lat, lon]);
  }

  // â¬‡ï¸ è™•ç†æ­£å¸¸çš„ DMS æ ¼å¼ï¼ˆå››ç¨®ï¼‰
  for (let m of block.matchAll(/(\d{6,8}\.\d+[NS])\/(\d{7,9}\.\d+[EW])/g))
    coords.push([dmsToDecimal(m[1]), dmsToDecimal(m[2])]);

  for (let m of block.matchAll(/(\d{6,8}\.\d+[NS])(\d{7,9}\.\d+[EW])/g))
    coords.push([dmsToDecimal(m[1]), dmsToDecimal(m[2])]);

  for (let m of block.matchAll(/(\d{6,8}[NS])\s+(\d{7,9}[EW])/g))
    coords.push([
      dmsToDecimal(normalizeDMS(m[1])),
      dmsToDecimal(normalizeDMS(m[2]))
    ]);

  for (let m of block.matchAll(/(\d{6,8}[NS])(\d{7,9}[EW])/g))
    coords.push([
      dmsToDecimal(normalizeDMS(m[1])),
      dmsToDecimal(normalizeDMS(m[2]))
    ]);

  // â¬‡ï¸ å¤šé‚Šå½¢åŠ é–‰åˆï¼ˆé‡å°åŒ…å« ; æˆ– TO POINT OF ORIGINï¼‰
  if ((/;/.test(block) || /TO POINT OF ORIGIN/i.test(block)) && coords.length > 0){
    coords.push(coords[0]);
    let p = L.polygon(coords, {color:'red', fillOpacity:0.5})
      .bindPopup(`<pre>${block}</pre>`, popupOptions)
      .addTo(map)
      .openPopup();
    shapeLayers.push(p);
    map.fitBounds(coords, {padding:[50,50], maxZoom:15});
    return;
  }

  // â¬‡ï¸ FAN
  let fan = block.match(/FAN.*?(\d+)\s*(KM|NM).*?OF\s*(\d{6,8}[NS])\s*(\d{7,9}[EW]).*?QTE\s*(\d+)DEG.*?(\d+)DEG/i);
  if (fan){
    let r = +fan[1];
    if (fan[2] === "NM") r *= 1.852;
    let lat = dmsToDecimal(normalizeDMS(fan[3]));
    let lon = dmsToDecimal(normalizeDMS(fan[4]));
    let sa = +fan[5], ea = +fan[6], pts = [[lat, lon]], steps = 30;

    for (let i = 0; i <= steps; i++){
      let a = (sa + (ea - sa) * (i/steps)) * Math.PI / 180;
      let dLat = (r/111.32) * Math.cos(a);
      let dLon = (r/(111.32 * Math.cos(lat * Math.PI / 180))) * Math.sin(a);
      pts.push([lat + dLat, lon + dLon]);
    }
    pts.push([lat, lon]);

    let p = L.polygon(pts, {color:'red', fillOpacity:0.4})
      .bindPopup(`<pre>${block}</pre>`, popupOptions)
      .addTo(map)
      .openPopup();
    shapeLayers.push(p);
    map.fitBounds(pts, {padding:[50,50], maxZoom:14});
    return;
  }

  // â¬‡ï¸ ARC
  let arc = block.match(/ARC OF A CIRCLE RADIUS (\d+)(NM|KM).*?CENTRED ON (\d{6,8}(\.\d+)?[NS])(\d{7,9}(\.\d+)?[EW])/i);
  if (arc){
    let r = +arc[1], u = arc[2];
    let lat = dmsToDecimal(arc[3]);
    let lon = dmsToDecimal(arc[5]);
    let rm = r * (u === "NM" ? 1852 : 1000);
    let c = L.circle([lat, lon], {radius:rm, color:'red', fillOpacity:0.3})
      .bindPopup(`<pre>${block}</pre>`, popupOptions)
      .addTo(map)
      .openPopup();
    shapeLayers.push(c);
    map.setView([lat, lon], 8);
    return;
  }

  // â¬‡ï¸ PSN ARC
  let parc = block.match(/PSN ARC (\d{6,8}[NS])\s*(\d{7,9}[EW]),?\s*RADIUS\s*(\d+)(NM|KM)/i);
  if (parc){
    let lat = dmsToDecimal(normalizeDMS(parc[1]));
    let lon = dmsToDecimal(normalizeDMS(parc[2]));
    let r = +parc[3], u = parc[4];
    let rm = r * (u === "NM" ? 1852 : 1000);
    let c = L.circle([lat, lon], {radius:rm, color:'red', fillOpacity:0.3})
      .bindPopup(`<pre>${block}</pre>`, popupOptions)
      .addTo(map)
      .openPopup();
    shapeLayers.push(c);
    map.setView([lat, lon], 10);
    return;
  }

  // â¬‡ï¸ CIRCLE
  let circ = block.match(/(?:DEFINED AS|WITHIN)? ?(\d+)(NM|KM) RADIUS OF (\d{6,8}[NS]) ?(\d{7,9}[EW])/i)
           || block.match(/RADIUS OF (\d{6,8}[NS]) (\d{7,9}[EW]) ?(\d+)(NM|KM)/i);
  if (circ){
    let r, u, lat, lon;
    if (circ.length === 5){
      r = +circ[1];
      u = circ[2];
      lat = dmsToDecimal(normalizeDMS(circ[3]));
      lon = dmsToDecimal(normalizeDMS(circ[4]));
    } else {
      lat = dmsToDecimal(normalizeDMS(circ[1]));
      lon = dmsToDecimal(normalizeDMS(circ[2]));
      r = +circ[3];
      u = circ[4];
    }
    let rm = r * (u === "NM" ? 1852 : 1000);
    let c = L.circle([lat, lon], {radius:rm, color:'red', fillOpacity:0.3})
      .bindPopup(`<pre>${block}</pre>`, popupOptions)
      .addTo(map)
      .openPopup();
    shapeLayers.push(c);
    map.setView([lat, lon], 8);
    return;
  }

  // â¬‡ï¸ PSN å–®é»
  let psn = block.match(/PSN.*?(\d{6,8}(\.\d+)?[NS]).*?(\d{7,9}(\.\d+)?[EW])/i);
  if (psn){
    let lat = dmsToDecimal(normalizeDMS(psn[1]));
    let lon = dmsToDecimal(normalizeDMS(psn[3]));
    let m = L.marker([lat, lon])
      .bindPopup(`<pre>${block}</pre>`, popupOptions)
      .addTo(map)
      .openPopup();
    shapeLayers.push(m);
    map.setView([lat, lon], 14);
    return;
  }

  // â¬‡ï¸ æœ€å¾Œå¤šé‚Šå½¢ fallbackï¼ˆLeaflet polygon æœƒè‡ªå‹•é–‰åˆï¼‰
  if (coords.length > 0){
    let p = L.polygon(coords, {color:'red', fillOpacity:0.5})
      .bindPopup(`<pre>${block}</pre>`, popupOptions)
      .addTo(map)
      .openPopup();
    shapeLayers.push(p);
    map.fitBounds(coords, {padding:[50,50], maxZoom:15});
    return;
  }

  alert("ä¸æ˜¯æ¨™æº–æ ¼å¼ï¼Œè«‹æ”¹ç”¨chatGPT");
}

// â¬‡ï¸ å…¶ä»–åŸºæœ¬æ“ä½œ
function addNotam(){
  let b = document.getElementById('notamInput').value;
  if (b.trim() === ""){
    alert("è«‹å…ˆè¼¸å…¥ NOTAM å…§å®¹");
    return;
  }
  parseNotamBlock(b);
  document.getElementById('notamInput').value = "";
}

function clearMap(){
  shapeLayers.forEach(l => map.removeLayer(l));
  shapeLayers = [];
  document.getElementById('notamInput').value = "";
}

function refreshIframe(id){
  const iframe = document.getElementById(id);
  if (iframe) iframe.src = iframe.src;
}

function setupChecklist(listId) {
  // ä¸åšä»»ä½•å„²å­˜ï¼Œé‡æ–°æ•´ç†å¾Œå°‡å›åˆ°æœªå‹¾é¸ç‹€æ…‹
  const list = document.getElementById(listId);
  if (!list) return;
  list.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
}


// åˆå§‹åŒ–å…©çµ„ checklist
setupChecklist("briefingChecklist1");
setupChecklist("briefingChecklist2");
setupChecklist("personalChecklist");

// äº‚æµçš„æ•˜è¿°æª”æ¡ˆ //
window.flights = [
  { flightNo: "820", route: "TPE/KIX" },
  { flightNo: "821", route: "KIX/TPE" },
  { flightNo: "233", route: "TPE/HKG" },
  { flightNo: "234", route: "HKG/TPE" },
  { flightNo: "235", route: "TPE/HKG" },
  { flightNo: "236", route: "HKG/TPE" },
  { flightNo: "205", route: "TPE/MFM" },
  { flightNo: "206", route: "MFM/TPE" },
  { flightNo: "846", route: "TPE/KMJ" },
  { flightNo: "847", route: "KMJ/TPE" },
  { flightNo: "771", route: "TPE/SIN" },
  { flightNo: "772", route: "SIN/TPE" },
  { flightNo: "838", route: "TPE/NGO" },
  { flightNo: "839", route: "NGO/TPE" },
  { flightNo: "840", route: "TPE/FUK" },
  { flightNo: "841", route: "FUK/TPE" },
  { flightNo: "850", route: "TPE/CTS" },
  { flightNo: "851", route: "CTS/TPE" },
  { flightNo: "862", route: "TPE/SDJ" },
  { flightNo: "863", route: "SDJ/TPE" },
  { flightNo: "713", route: "TPE/SGN" },
  { flightNo: "714", route: "SGN/TPE" },
  { flightNo: "804", route: "TPE/NRT" },
  { flightNo: "805", route: "NRT/TPE" }
  ];  


function initFlightSelect() {
  const selectEl = document.getElementById("flightSelect");
  const dateSelectEl = document.getElementById("dateSelect");
  const btn = document.getElementById("turbliBtn");

  console.log("âœ… initFlightSelect called, element:", selectEl);

  if (!selectEl || !dateSelectEl || !btn) {
    console.warn("â›” æ‰¾ä¸åˆ°æŸäº› DOM å…ƒç´ ");
    return;
  }

  const defaultOption = document.createElement("option");
  defaultOption.value = "";
  defaultOption.textContent = "-- è«‹é¸æ“‡èˆªç­ --";
  selectEl.appendChild(defaultOption);

  window.flights
    .sort((a, b) => a.flightNo.localeCompare(b.flightNo, 'en', { numeric: true }))
    .forEach(item => {
      console.log("ğŸ›¬ Adding flight:", item.flightNo);
      const opt = document.createElement("option");
      opt.value = item.flightNo;
      opt.textContent = item.flightNo;
      selectEl.appendChild(opt);
    });

  function updateTurbliUrl() {
    const selectedFlight = selectEl.value;
    const selectedDate = dateSelectEl.value;

    if (!selectedFlight) {
      btn.disabled = true;
      btn.dataset.url = "";
      return;
    }

    const date = new Date();
    if (selectedDate === "tomorrow") {
      date.setDate(date.getDate() + 1);
    }

    const yyyy = date.getFullYear();
    const mm = String(date.getMonth() + 1).padStart(2, '0');
    const dd = String(date.getDate()).padStart(2, '0');
    const dateStr = `${yyyy}-${mm}-${dd}`;

    const flight = window.flights.find(f => f.flightNo === selectedFlight);
    if (!flight) {
      console.warn("âš ï¸ æ‰¾ä¸åˆ°å°æ‡‰èˆªç­è³‡æ–™");
      return;
    }

    btn.dataset.url = `https://turbli.com/${flight.route}/${dateStr}/JX-${selectedFlight}/`;
    btn.disabled = false;
  }

  // ç¶å®šå…©å€‹é¸å–®çš„ change äº‹ä»¶
  selectEl.addEventListener("change", updateTurbliUrl);
  dateSelectEl.addEventListener("change", updateTurbliUrl);
}

// åˆå§‹åŒ–èˆ‡æŒ‰éˆ•é»æ“Šäº‹ä»¶
document.addEventListener("DOMContentLoaded", function () {
  initFlightSelect();

  document.getElementById("turbliBtn").addEventListener("click", function () {
    const url = this.dataset.url;
    if (url) window.open(url, "_blank");
  });
});

 function openDatis() {
    const sel = document.getElementById("datisSelect");
    const url = sel.value;
    if (url) window.open(url, '_blank');
  }

 function openCitywx() {
  const select = document.getElementById("citywxSelect");
  const url = select.value;
  if (url && url !== "--è«‹é¸æ“‡åŸå¸‚--") {
    window.open(url, "_blank");
  }
} 


  // â›½ Fuel Distribution & Refuel Time Calculator ------------------------------

// ä¾ç…§æä¾›çš„è¡¨æ ¼å»ºç«‹å°ç…§è³‡æ–™ï¼ˆå–®ä½ï¼šå™¸ï¼Œç‚ºå·¦å³åˆè¨ˆï¼‰
const fuelTable = [
  { total: 8.8,  inner: 9.0,  outer: 5.6, trim: 0.0, center: 0.0 },
  { total: 14.6, inner: 9.0,  outer: 5.6, trim: 0.0, center: 0.0 },
  { total: 24.0, inner: 18.4, outer: 5.6, trim: 0.0, center: 0.0 },
  { total: 27.6, inner: 18.4, outer: 5.6, trim: 3.6, center: 0.0 },
  { total: 30.0, inner: 20.8, outer: 5.6, trim: 3.6, center: 0.0 },
  { total: 40.0, inner: 30.8, outer: 5.6, trim: 3.6, center: 0.0 },
  { total: 60.0, inner: 50.8, outer: 5.6, trim: 3.6, center: 0.0 },
  { total: 75.0, inner: 65.6, outer: 5.6, trim: 3.8, center: 0.0 },
  { total: 100.0,inner: 68.2, outer: 5.6, trim: 3.8, center: 22.4 }
];

function interpolateFuel(total) {
  const table = fuelTable;
  const n = table.length;
  if (n === 0) return null;
  if (total < table[0].total || total > table[n - 1].total) {
    return null;
  }
  for (let i = 0; i < n; i++) {
    if (Math.abs(total - table[i].total) < 1e-6) {
      return {
        total: total,
        inner: table[i].inner,
        outer: table[i].outer,
        trim: table[i].trim,
        center: table[i].center
      };
    }
  }
  for (let i = 1; i < n; i++) {
    const prev = table[i - 1];
    const curr = table[i];
    if (total < curr.total + 1e-6) {
      const ratio = (total - prev.total) / (curr.total - prev.total);
      const lerp = (a, b) => a + (b - a) * ratio;
      return {
        total: total,
        inner:  lerp(prev.inner,  curr.inner),
        outer:  lerp(prev.outer,  curr.outer),
        trim:   lerp(prev.trim,   curr.trim),
        center: lerp(prev.center, curr.center)
      };
    }
  }
  const last = table[n - 1];
  return {
    total: total,
    inner: last.inner,
    outer: last.outer,
    trim: last.trim,
    center: last.center
  };
}

function formatFuel(value) {
  return value.toFixed(1);
}

function formatTimeMin(value) {
  return value.toFixed(1);
}

function formatTimeHHMM(value) {
  if (!isFinite(value) || value <= 0) return "0 åˆ†é˜";
  const totalMin = Math.round(value);
  const h = Math.floor(totalMin / 60);
  const m = totalMin % 60;
  if (h === 0) return m + " åˆ†é˜";
  return h + " å°æ™‚ " + m + " åˆ†";
}

// è¨ˆç®— Inner/Outer/Center å…±äº« 1 t/min çš„åŠ æ²¹æ™‚é–“ï¼ˆå‹•æ…‹åˆ†é…æµé‡ï¼‰
function computeIOCRefuel(dInner, dOuter, dCenter) {
  const remaining = {
    inner: Math.max(dInner, 0),
    outer: Math.max(dOuter, 0),
    center: Math.max(dCenter, 0)
  };
  const original = { inner: remaining.inner, outer: remaining.outer, center: remaining.center };
  const finishTime = { inner: 0, outer: 0, center: 0 };

  let t = 0;
  const eps = 1e-8;
  const order = ["inner", "outer", "center"];

  while (true) {
    const active = order.filter(key => remaining[key] > eps);
    if (active.length === 0) break;

    const k = active.length; // åŒæ™‚åœ¨åŠ æ²¹çš„æ²¹ç®±æ•¸
    let dt = Infinity;

    // å°æ¯ä¸€å€‹ active tankï¼Œè¨ˆç®—åœ¨ç›®å‰åˆ†é…ä¸‹åˆ°é”ç›®æ¨™é‚„éœ€è¦å¤šä¹…
    for (const key of active) {
      const rem = remaining[key];
      const timeToFinish = rem * k; // å› ç‚ºå„è‡ªæµé‡ = 1/k t/min
      if (timeToFinish < dt) dt = timeToFinish;
    }

    // å‰é€² dt åˆ†é˜
    t += dt;
    for (const key of active) {
      remaining[key] -= dt / active.length; // æ¯å€‹æ²¹ç®±åœ¨ dt å…§è£œé€² dt/k å™¸
      if (remaining[key] < eps) {
        remaining[key] = 0;
        if (finishTime[key] === 0 && original[key] > 0) {
          finishTime[key] = t; // ç¬¬ä¸€æ¬¡é”åˆ°ç›®æ¨™çš„æ™‚é–“
        }
      }
    }
  }

  return {
    tInner: finishTime.inner,
    tOuter: finishTime.outer,
    tCenter: finishTime.center,
    groupTime: t
  };
}

function computeRefuel(currentTotal, targetTotal, finalDist) {
  // èµ·å§‹åˆ†å¸ƒï¼šInner = currentTotal, å…¶ä»– = 0
  const inner0  = currentTotal;
  const outer0  = 0.0;
  const trim0   = 0.0;
  const center0 = 0.0;

  let dInner  = finalDist.inner  - inner0;
  let dOuter  = finalDist.outer  - outer0;
  let dTrim   = finalDist.trim   - trim0;
  let dCenter = finalDist.center - center0;

  // ä¸è€ƒæ…®æ”¾æ²¹ï¼šè‹¥ç›®æ¨™æ²¹é‡å°æ–¼èµ·å§‹æ²¹é‡å‰‡è¦–ç‚º 0ï¼ˆåƒ…å…§éƒ¨åˆ†é…ï¼‰
  dInner  = Math.max(dInner,  0);
  dOuter  = Math.max(dOuter,  0);
  dTrim   = Math.max(dTrim,   0);
  dCenter = Math.max(dCenter, 0);

  // Inner/Outer/Center å…±ç”¨ 1 t/minï¼Œå‹•æ…‹åˆ†é…
  const ioc = computeIOCRefuel(dInner, dOuter, dCenter);

  // Trim Tank ç¨ç«‹åŠ æ²¹ï¼Œå›ºå®š 0.10 t/min
  const rateTrim = 0.10;
  const tTrim = dTrim > 0 ? dTrim / rateTrim : 0;

  const totalDelta = dInner + dOuter + dTrim + dCenter;
  const totalTime  = Math.max(ioc.groupTime, tTrim);
  const effRate    = totalTime > 0 ? totalDelta / totalTime : 0; // t/min

  return {
    dInner, dOuter, dTrim, dCenter,
    tInner: ioc.tInner,
    tOuter: ioc.tOuter,
    tCenter: ioc.tCenter,
    tTrim,
    totalDelta,
    totalTime,
    effRate
  };
}

function onCalculate() {
  const currentEl = document.getElementById("currentFuel");
  const targetEl  = document.getElementById("targetFuel");
  const messageEl = document.getElementById("message");

  const currentTotal = parseFloat(currentEl.value);
  const targetTotal  = parseFloat(targetEl.value);

  if (Number.isNaN(currentTotal) || Number.isNaN(targetTotal)) {
    messageEl.textContent = "è«‹è¼¸å…¥æœ‰æ•ˆçš„ã€ç›®å‰å‰©æ²¹ã€èˆ‡ã€ç›®æ¨™ Total Fuelã€ï¼ˆå™¸ï¼‰ã€‚";
    updateDistribution(null);
    updateTimeTable(null);
    return;
  }

  if (targetTotal <= currentTotal) {
    messageEl.textContent = "ç›®æ¨™ Total Fuel å¿…é ˆå¤§æ–¼ç›®å‰å‰©æ²¹ï¼Œæš«ä¸æ”¯æ´æ”¾æ²¹æˆ–åƒ…æ²¹ç®±å†åˆ†é…æƒ…å¢ƒã€‚";
    updateDistribution(null);
    updateTimeTable(null);
    return;
  }

  const finalDist = interpolateFuel(targetTotal);
  if (!finalDist) {
    const min = fuelTable[0].total;
    const max = fuelTable[fuelTable.length - 1].total;
    messageEl.textContent =
      "è¶…å‡ºè³‡æ–™ç¯„åœã€‚è«‹è¼¸å…¥ä»‹æ–¼ " + min + " t ï½ " + max + " t ä¹‹é–“çš„æ•¸å€¼ã€‚";
    updateDistribution(null);
    updateTimeTable(null);
    return;
  }

  messageEl.textContent = "";
  updateDistribution(finalDist);

  const refuel = computeRefuel(currentTotal, targetTotal, finalDist);
  updateTimeTable(refuel);
}

function updateDistribution(result) {
  const tbody = document.getElementById("resultBody");
  if (!result) {
    tbody.innerHTML = `
      <tr><td>Inner Tank</td><td>-</td></tr>
      <tr><td>Outer Tank</td><td>-</td></tr>
      <tr><td>Trim Tank</td><td>-</td></tr>
      <tr><td>Center Tank</td><td>-</td></tr>
      <tr><th>Total (Inner+Outer+Trim+Center)</th><th>-</th></tr>
    `;
    return;
  }
  const inner  = result.inner;
  const outer  = result.outer;
  const trim   = result.trim;
  const center = result.center;
  const sum    = inner + outer + trim + center;

  tbody.innerHTML = `
    <tr><td>Inner Tank</td><td>${formatFuel(inner)}</td></tr>
    <tr><td>Outer Tank</td><td>${formatFuel(outer)}</td></tr>
    <tr><td>Trim Tank</td><td>${formatFuel(trim)}</td></tr>
    <tr><td>Center Tank</td><td>${formatFuel(center)}</td></tr>
    <tr><th>Total (Inner+Outer+Trim+Center)</th><th>${formatFuel(sum)}</th></tr>
  `;
}

function updateTimeTable(data) {
  const tbody = document.getElementById("timeBody");
  if (!data) {
    tbody.innerHTML = `
      <tr><td>Inner Tank</td><td>-</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>-</td></tr>
      <tr><td>Outer Tank</td><td>-</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>-</td></tr>
      <tr><td>Trim Tank</td><td>-</td><td>0.10</td><td>-</td></tr>
      <tr><td>Center Tank</td><td>-</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>-</td></tr>
      <tr><th>ç¸½åŠ æ²¹é‡ (t)</th><th>-</th><th>ç­‰æ•ˆæµé‡ (t/min)</th><th>-</th></tr>
      <tr><th>ç¸½åŠ æ²¹æ™‚é–“</th><th colspan="3">-</th></tr>
    `;
    return;
  }

  const {
    dInner, dOuter, dTrim, dCenter,
    tInner, tOuter, tTrim, tCenter,
    totalDelta,
    totalTime,
    effRate
  } = data;

  tbody.innerHTML = `
    <tr><td>Inner Tank</td><td>${formatFuel(dInner)}</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>${formatTimeMin(tInner)}</td></tr>
    <tr><td>Outer Tank</td><td>${formatFuel(dOuter)}</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>${formatTimeMin(tOuter)}</td></tr>
    <tr><td>Trim Tank</td><td>${formatFuel(dTrim)}</td><td>0.10</td><td>${formatTimeMin(tTrim)}</td></tr>
    <tr><td>Center Tank</td><td>${formatFuel(dCenter)}</td><td>å‹•æ…‹åˆ†é… (å…± 1.0)</td><td>${formatTimeMin(tCenter)}</td></tr>
    <tr><th>ç¸½åŠ æ²¹é‡ (t)</th><th>${formatFuel(totalDelta)}</th><th>ç­‰æ•ˆæµé‡ (t/min)</th><th>${effRate.toFixed(2)}</th></tr>
    <tr><th>ç¸½åŠ æ²¹æ™‚é–“</th><th colspan="3">${formatTimeHHMM(totalTime)} ï¼ˆç´„ ${formatTimeMin(totalTime)} åˆ†ï¼‰</th></tr>
  `;
}

</script>

</body>
</html>

